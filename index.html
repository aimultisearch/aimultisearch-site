const SHEET_ID = '182rlNjusTLdwUskd-p3utaC5npb_0lZkZCksgPV8sGk';  // <-- à remplacer

const SHEET_NAME = 'Feuille 1';  // nom EXACT de l’onglet (en bas du Google Sheet)

function getSheet() {
  const ss = SpreadsheetApp.openById(SHEET_ID);
  const sheet = ss.getSheetByName(SHEET_NAME);
  if (!sheet) {
    throw new Error('Feuille introuvable : ' + SHEET_NAME);
  }
  return sheet;
}

function doPost(e) {
  try {
    var email = e.parameter.email;

    if (!email) {
      return buildResponse(false, 'Email manquant');
    }

    const sheet = getSheet();

    // Ajoute une ligne : [date, email]
    sheet.appendRow([new Date(), email]);

    return buildResponse(true, 'OK');
  } catch (err) {
    return buildResponse(false, 'Erreur : ' + err.toString());
  }
}

function doGet(e) {
  return buildResponse(true, 'OK');
}

function buildResponse(success, message) {
  return ContentService
    .createTextOutput(JSON.stringify({ success: success, message: message }))
    .setMimeType(ContentService.MimeType.JSON);
}
